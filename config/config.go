package config\n\nimport (\n\t&quot;log&quot;\n\t&quot;os&quot;\n\t&quot;strconv&quot;\n)\n\ntype ConfigStruct struct {\n\tDiscord    DiscordConfig\n\tNGrok      NGrokConfig\n\tTunnel     TunnelConfig\n\tOptions    Options\n\tYoutube    YoutubeConfig\n\tGemini     GeminiConfig\n\tSpotify    SpotifyConfig\n}\n\ntype DiscordConfig struct {\n\tBotToken  string\n\tAppID     string\n\tPublicKey string\n}\n\ntype NGrokConfig struct {\n\tDomain    string\n\tAuthToken string\n}\n\ntype TunnelConfig struct {\n\tProvider           string // &quot;ngrok&quot; or &quot;cloudflare&quot;\n\tCloudflareTunnelURL string\n}\n\ntype YoutubeConfig struct {\n\tAPIKey        string\n\tPlaylistLimit int\n}\n\ntype GeminiConfig struct {\n\tEnabled bool\n\tAPIKey  string\n}\n\ntype SpotifyConfig struct {\n\tClientID      string\n\tClientSecret  string\n\tEnabled       bool\n\tPlaylistLimit int\n}\n\ntype Options struct {\n\tEnforceVoiceChannel bool\n\tPort                string\n\tIdleTimeoutMinutes  int\n\tAudioBitrate        int // Audio bitrate in bps (e.g., 96000 for 96 kbps)\n}\n\nfunc (ngrok *NGrokConfig) IsEnabled() bool {\n\treturn ngrok.Domain != &quot;&quot; &amp;&amp; ngrok.AuthToken != &quot;&quot;\n}\n\nfunc (t *TunnelConfig) IsCloudflare() bool {\n\treturn t.Provider == &quot;cloudflare&quot; &amp;&amp; t.CloudflareTunnelURL != &quot;&quot;\n}\n\nfunc getEnvDefault(key, defaultVal string) string {\n\tif val := os.Getenv(key); val != &quot;&quot; {\n\t\treturn val\n\t}\n\treturn defaultVal\n}\n\nfunc (options *Options) EnforceVoiceChannelEnabled() bool {\n\treturn options.EnforceVoiceChannel\n}\n\nvar Config *ConfigStruct\n\nfunc NewConfig() {\n\tconfig := &amp;ConfigStruct{\n\t\tDiscord: DiscordConfig{\n\t\t\tBotToken:  os.Getenv(&quot;DISCORD_BOT_TOKEN&quot;),\n\t\t\tAppID:     os.Getenv(&quot;DISCORD_APP_ID&quot;),\n\t\t\tPublicKey: os.Getenv(&quot;DISCORD_PUBLIC_KEY&quot;),\n\t\t},\n\t\tNGrok: NGrokConfig{\n\t\t\tDomain:    os.Getenv(&quot;NGROK_DOMAIN&quot;),\n\t\t\tAuthToken: os.Getenv(&quot;NGROK_AUTHTOKEN&quot;),\n\t\t},\n\t\tTunnel: TunnelConfig{\n\t\t\tProvider:           getEnvDefault(&quot;TUNNEL_PROVIDER&quot;, &quot;ngrok&quot;),\n\t\t\tCloudflareTunnelURL: os.Getenv(&quot;CLOUDFLARE_TUNNEL_URL&quot;),\n\t\t},\n\t\tOptions: Options{\n\t\t\tEnforceVoiceChannel: os.Getenv(&quot;ENFORCE_VOICE_CHANNEL&quot;) == &quot;true&quot;,\n\t\t\tPort:                os.Getenv(&quot;PORT&quot;),\n\t\t\tIdleTimeoutMinutes:  getIdleTimeout(),\n\t\t\tAudioBitrate:        getAudioBitrate(),\n\t\t},\n\t\tYoutube: YoutubeConfig{\n\t\t\tAPIKey:        os.Getenv(&quot;YOUTUBE_API_KEY&quot;),\n\t\t\tPlaylistLimit: getYouTubePlaylistLimit(),\n\t\t},\n\t\tGemini: GeminiConfig{\n\t\t\tEnabled: os.Getenv(&quot;GEMINI_ENABLED&quot;) == &quot;true&quot;,\n\t\t\tAPIKey:  os.Getenv(&quot;GEMINI_API_KEY&quot;),\n\t\t},\n\t\tSpotify: SpotifyConfig{\n\t\t\tClientID:      os.Getenv(&quot;SPOTIFY_CLIENT_ID&quot;),\n\t\t\tClientSecret:  os.Getenv(&quot;SPOTIFY_CLIENT_SECRET&quot;),\n\t\t\tEnabled:       os.Getenv(&quot;SPOTIFY_ENABLED&quot;) == &quot;true&quot;,\n\t\t\tPlaylistLimit: getPlaylistLimit(),\n\t\t},\n\t}\n\n\tConfig = config\n}\n\nfunc getIdleTimeout() int {\n\ttimeoutStr := os.Getenv(&quot;IDLE_TIMEOUT_MINUTES&quot;)\n\tif timeoutStr == &quot;&quot; {\n\t\treturn 20\n\t}\n\ttimeout, err := strconv.Atoi(timeoutStr)\n\tif err != nil || timeout &lt;= 0 {\n\t\treturn 20\n\t}\n\treturn timeout\n}\n\nfunc getPlaylistLimit() int {\n\tlimitStr := os.Getenv(&quot;SPOTIFY_PLAYLIST_LIMIT&quot;)\n\tif limitStr == &quot;&quot; {\n\t\treturn 10\n\t}\n\tlimit, err := strconv.Atoi(limitStr)\n\tif err != nil || limit &lt;= 0 {\n\t\treturn 10\n\t}\n\tif limit &gt; 50 {\n\t\treturn 50 // Cap at 50 for API and performance reasons\n\t}\n\treturn limit\n}\n\nfunc getYouTubePlaylistLimit() int {\n\tlimitStr := os.Getenv(&quot;YOUTUBE_PLAYLIST_LIMIT&quot;)\n\tif limitStr == &quot;&quot; {\n\t\treturn 15\n\t}\n\tlimit, err := strconv.Atoi(limitStr)\n\tif err != nil || limit &lt;= 0 {\n\t\treturn 15\n\t}\n\tif limit &gt; 50 {\n\t\treturn 50 // Cap at 50 (YouTube API max per page)\n\t}\n\treturn limit\n}\n\nfunc getAudioBitrate() int {\n\tbitrateStr := os.Getenv(&quot;AUDIO_BITRATE&quot;)\n\tif bitrateStr == &quot;&quot; {\n\t\treturn 96000 // Default to 96 kbps - good balance of quality and stability\n\t}\n\tbitrate, err := strconv.Atoi(bitrateStr)\n\tif err != nil || bitrate &lt;= 0 {\n\t\treturn 96000\n\t}\n\n\t// Discord supports 8 kbps to 512 kbps for Opus\n\t// Practical ranges: 8-128 kbps (voice), up to 384 kbps (stage/boost)\n\n\tconst minBitrate = 8000\n\tconst maxBitrate = 512000\n\n\tif bitrate &lt; minBitrate {\n\t\tlog.Printf(&quot;Warning: AUDIO_BITRATE=%%s clamped to minimum %%d bps (requested %%d bps)&quot;, bitrateStr, minBitrate, bitrate)\n\t\treturn minBitrate\n\t}\n\tif bitrate &gt; maxBitrate {\n\t\tlog.Printf(&quot;Warning: AUDIO_BITRATE=%%s clamped to maximum %%d bps (requested %%d bps)&quot;, bitrateStr, maxBitrate, bitrate)\n\t\treturn maxBitrate\n\t}\n\treturn bitrate\n}\n